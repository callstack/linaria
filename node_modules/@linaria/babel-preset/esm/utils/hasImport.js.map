{"version":3,"sources":["../../src/utils/hasImport.ts"],"names":["dirname","Module","linariaLibs","Set","safeResolve","name","require","resolve","err","hasImport","t","scope","filename","identifier","sources","libResolver","binding","getAllBindings","p","path","resolveFromFile","id","_resolveFilename","paths","_nodeModulePaths","e","isImportingModule","value","some","source","has","isImportSpecifier","isImportDeclaration","parentPath","node","isVariableDeclarator","isCallExpression","init","isIdentifier","callee","arguments","length","isStringLiteral","isTemplateLiteral","quasis","cooked"],"mappings":"AAAA,SAASA,OAAT,QAAwB,MAAxB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AAEA,MAAMC,WAAW,GAAG,IAAIC,GAAJ,CAAQ,CAC1B,eAD0B,EAE1B,gBAF0B,EAG1B,iBAH0B,EAI1B,SAJ0B,EAK1B,eAL0B,CAAR,CAApB;;AAQA,MAAMC,WAAW,GAAIC,IAAD,IAAkB;AACpC,MAAI;AACF,WAAOC,OAAO,CAACC,OAAR,CAAgBF,IAAhB,CAAP;AACD,GAFD,CAEE,OAAOG,GAAP,EAAY;AACZ,WAAO,IAAP;AACD;AACF,CAND,C,CAQA;;;AACA,eAAe,SAASC,SAAT,CACbC,CADa,EAEbC,KAFa,EAGbC,QAHa,EAIbC,UAJa,EAKbC,OALa,EAMbC,WAAW,GAAGX,WAND,EAOJ;AACT,QAAMY,OAAO,GAAGL,KAAK,CAACM,cAAN,GAAuBJ,UAAvB,CAAhB;;AAEA,MAAI,CAACG,OAAL,EAAc;AACZ,WAAO,KAAP;AACD;;AAED,QAAME,CAAC,GAAGF,OAAO,CAACG,IAAlB;;AAEA,QAAMC,eAAe,GAAIC,EAAD,IAAgB;AACtC,QAAI;AACF,aAAOpB,MAAM,CAACqB,gBAAP,CAAwBD,EAAxB,EAA4B;AACjCA,QAAAA,EAAE,EAAET,QAD6B;AAEjCA,QAAAA,QAFiC;AAGjCW,QAAAA,KAAK,EAAEtB,MAAM,CAACuB,gBAAP,CAAwBxB,OAAO,CAACY,QAAD,CAA/B;AAH0B,OAA5B,CAAP;AAKD,KAND,CAME,OAAOa,CAAP,EAAU;AACV,aAAO,IAAP;AACD;AACF,GAVD;;AAYA,QAAMC,iBAAiB,GAAIC,KAAD,IACxBb,OAAO,CAACc,IAAR,CACGC,MAAD,IACE;AACAF,EAAAA,KAAK,KAAKE,MAAV,IACA;AACAT,EAAAA,eAAe,CAACO,KAAD,CAAf,MACGzB,WAAW,CAAC4B,GAAZ,CAAgBD,MAAhB,IACGd,WAAW,CAACc,MAAD,CADd,GAEGT,eAAe,CAACS,MAAD,CAHrB,CALJ,CADF;;AAYA,MAAInB,CAAC,CAACqB,iBAAF,CAAoBb,CAApB,KAA0BR,CAAC,CAACsB,mBAAF,CAAsBd,CAAC,CAACe,UAAxB,CAA9B,EAAmE;AACjE,WAAOP,iBAAiB,CAACR,CAAC,CAACe,UAAF,CAAaC,IAAb,CAAkBL,MAAlB,CAAyBF,KAA1B,CAAxB;AACD;;AAED,MAAIjB,CAAC,CAACyB,oBAAF,CAAuBjB,CAAvB,CAAJ,EAA+B;AAC7B,QACER,CAAC,CAAC0B,gBAAF,CAAmBlB,CAAC,CAACgB,IAAF,CAAOG,IAA1B,KACA3B,CAAC,CAAC4B,YAAF,CAAepB,CAAC,CAACgB,IAAF,CAAOG,IAAP,CAAYE,MAA3B,CADA,IAEArB,CAAC,CAACgB,IAAF,CAAOG,IAAP,CAAYE,MAAZ,CAAmBlC,IAAnB,KAA4B,SAF5B,IAGAa,CAAC,CAACgB,IAAF,CAAOG,IAAP,CAAYG,SAAZ,CAAsBC,MAAtB,KAAiC,CAJnC,EAKE;AACA,YAAMP,IAAI,GAAGhB,CAAC,CAACgB,IAAF,CAAOG,IAAP,CAAYG,SAAZ,CAAsB,CAAtB,CAAb;;AAEA,UAAI9B,CAAC,CAACgC,eAAF,CAAkBR,IAAlB,CAAJ,EAA6B;AAC3B,eAAOR,iBAAiB,CAACQ,IAAI,CAACP,KAAN,CAAxB;AACD;;AAED,UAAIjB,CAAC,CAACiC,iBAAF,CAAoBT,IAApB,KAA6BA,IAAI,CAACU,MAAL,CAAYH,MAAZ,KAAuB,CAAxD,EAA2D;AACzD,eAAOf,iBAAiB,CAACQ,IAAI,CAACU,MAAL,CAAY,CAAZ,EAAejB,KAAf,CAAqBkB,MAAtB,CAAxB;AACD;AACF;AACF;;AAED,SAAO,KAAP;AACD","sourcesContent":["import { dirname } from 'path';\nimport Module from '../module';\n\nconst linariaLibs = new Set([\n  '@linaria/core',\n  '@linaria/react',\n  '@linaria/atomic',\n  'linaria',\n  'linaria/react',\n]);\n\nconst safeResolve = (name: string) => {\n  try {\n    return require.resolve(name);\n  } catch (err) {\n    return null;\n  }\n};\n\n// Verify if the binding is imported from the specified source\nexport default function hasImport(\n  t: any,\n  scope: any,\n  filename: string,\n  identifier: string,\n  sources: string[],\n  libResolver = safeResolve\n): boolean {\n  const binding = scope.getAllBindings()[identifier];\n\n  if (!binding) {\n    return false;\n  }\n\n  const p = binding.path;\n\n  const resolveFromFile = (id: string) => {\n    try {\n      return Module._resolveFilename(id, {\n        id: filename,\n        filename,\n        paths: Module._nodeModulePaths(dirname(filename)),\n      });\n    } catch (e) {\n      return null;\n    }\n  };\n\n  const isImportingModule = (value: string) =>\n    sources.some(\n      (source) =>\n        // If the value is an exact match, assume it imports the module\n        value === source ||\n        // Otherwise try to resolve both and check if they are the same file\n        resolveFromFile(value) ===\n          (linariaLibs.has(source)\n            ? libResolver(source)\n            : resolveFromFile(source))\n    );\n\n  if (t.isImportSpecifier(p) && t.isImportDeclaration(p.parentPath)) {\n    return isImportingModule(p.parentPath.node.source.value);\n  }\n\n  if (t.isVariableDeclarator(p)) {\n    if (\n      t.isCallExpression(p.node.init) &&\n      t.isIdentifier(p.node.init.callee) &&\n      p.node.init.callee.name === 'require' &&\n      p.node.init.arguments.length === 1\n    ) {\n      const node = p.node.init.arguments[0];\n\n      if (t.isStringLiteral(node)) {\n        return isImportingModule(node.value);\n      }\n\n      if (t.isTemplateLiteral(node) && node.quasis.length === 1) {\n        return isImportingModule(node.quasis[0].value.cooked);\n      }\n    }\n  }\n\n  return false;\n}\n"],"file":"hasImport.js"}